<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Fotos</title>

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .ekko-lightbox-nav-overlay a {
            color: goldenrod;
        }

        .gallery-title {
            text-align: center;
            font-weight: 500;
            border-bottom: 1px dotted orange;
            margin-top: 1em;
        }
    </style>

    <!-- Custom styles for this template -->
    <link href="css/form-validation.css" rel="stylesheet">
</head>

<body  class="bg-light">

    <div class="container">
        <main>
            <div class="py-5 text-center">
                <h2>Albumes</h2>
            </div>

            <div class="row g-3">
                <div class="col-md-3 col-lg-3 ">

                    <form class="card p-2">
                        <div class="col-12">
                            <img id="fotoPer" src="resources/no-photo.jpg" alt="..." class="img-thumbnail">
                        </div>

                        <hr class="my-4">

                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" type="button" onclick="SubirFotoButton();">Subir Foto</button>
                            <button class="btn btn-primary" type="button" onclick="EditarAlbumButton();">Editar Albumes</button>
                            <button class="btn btn-primary" type="button" onclick="RegresarButton();">Regresar</button>
                        </div>
                    </form>
                </div>
                <div class="col-md-9 col-lg-9">
                    <div class="container">
                        <div class="row">
                            <div id = "albumes" class="col-12">
                            </div>
                        </div>
                    </div>

                </div>
        </main>

        <footer class="my-5 pt-5 text-muted text-center text-small">
            <p class="mb-1">&copy; 2021</p>

        </footer>
    </div>
    <script src="js/form-validation.js"></script>
</body>

</html>

<script>
    var url_string = window.location.href; //window.location.href
    var url = new URL(url_string);
    var idUser = url.searchParams.get("id");
    var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 
    var theUrl = "http://Practica1-508450024.us-east-2.elb.amazonaws.com/fotos/" + idUser;

    xmlhttp.open("GET", theUrl);
    xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xmlhttp.onload  = function() {
    var jsonResponse = JSON.parse(xmlhttp.responseText);
    // do something with jsonResponse
    if(jsonResponse.estado == "OK"){

        var result = jsonResponse.content.fotos.reduce(function (r, a) {
                r[a.nombre_album] = r[a.nombre_album] || [];
                r[a.nombre_album].push(a);
                return r;
            }, Object.create(null));

        
        var select = document.getElementById("albumes");
        var h3=document.createElement("h3");
        h3.className = "gallery-title";
        h3.textContent = "Fotos de Perfil";

        select.appendChild(h3);

        var div=document.createElement("div");
        div.className = "row";

        for (let index = 0; index < jsonResponse.content.perfil.length; index++) {
            
            const element = jsonResponse.content.perfil[index];
            var a = document.createElement("a");
            a.className = "col-lg-3 col-md-4 col-6 my-3";
            a.setAttribute('href', "https://practica1-g1-imagenes.s3.us-east-2.amazonaws.com/Fotos_Perfil/" + element.nombre_imagen);
            a.setAttribute('data-toggle', "lightbox");
            a.setAttribute('data-gallery', "example-gallery");

            var img = document.createElement("img");
            img.className = "img-fluid card";
            img.setAttribute('src', "https://practica1-g1-imagenes.s3.us-east-2.amazonaws.com/Fotos_Perfil/" + element.nombre_imagen);

            a.appendChild(img);
            div.appendChild(a);

            var img2 = document.getElementById("fotoPer");
            img2.className = "img-thumbnail";
            img2.setAttribute('src', "https://practica1-g1-imagenes.s3.us-east-2.amazonaws.com/Fotos_Perfil/" + element.nombre_imagen);
        }

        select.appendChild(div);

        Object.keys(result).forEach(function(key) {
            var value = result[key];

            var select = document.getElementById("albumes");
            var h3=document.createElement("h3");
            h3.className = "gallery-title";
            h3.textContent = key;

            select.appendChild(h3);

            var div=document.createElement("div");
            div.className = "row";

            for (let index = 0; index < value.length; index++) {
                const element = value[index];
                var a = document.createElement("a");
                a.className = "col-lg-3 col-md-4 col-6 my-3";
                a.setAttribute('href', "https://practica1-g1-imagenes.s3.us-east-2.amazonaws.com/Fotos_Publicadas/" + element.nombre_foto);
                a.setAttribute('data-toggle', "lightbox");
                a.setAttribute('data-gallery', "example-gallery");

                var img = document.createElement("img");
                img.className = "img-fluid card";
                img.setAttribute('src', "https://practica1-g1-imagenes.s3.us-east-2.amazonaws.com/Fotos_Publicadas/" + element.nombre_foto);

                a.appendChild(img);
                div.appendChild(a);
                
            }
            
            select.appendChild(div);
        });


        //document.getElementById("user1").value = jsonResponse.content[0].username; 
        //document.getElementById("name1").value = jsonResponse.content[0].nombre; 
        
        //document.location = 'inicio.html'; //CREAR OTRO XML AQUI?
    } else {
        console.log("No existe el usuario");
    }
    };
    xmlhttp.send();

    function SubirFotoButton(){
        document.location='subirfoto.html?id='+ idUser;
    }

    function EditarAlbumButton(){
        document.location='editaralbum.html?id='+ idUser;
    }

    function RegresarButton(){
        document.location='inicio.html?id='+ idUser;
    }


</script>